<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test task for MGS</title>

</head>
<style>
    #length {
        width: 300px;
    }
</style>
<body>

<h2>I was created to generate sequences of numbers. <br>
    If you want to specify the length of the sequence, enter it in the line below and the AUTO button. <br>
    If you want to get 5 random sequences - press the GENERATE button.</h2>

<div class="container">
    <div id="messages" class="messages"></div>
    <div class="input-fields">
        <input type="number" min="10" max="100" name="length" id="length"
               placeholder="Set the length of the array..." required>
        <button id="auto">AUTO</button>
<!--        <button onclick="auto()">AUTO</button>-->
        <button id="generate">GENERATE</button>
    </div>
</div>

</body>

<script>

    const messageWindow = document.getElementById("messages");

    const sendAutoButton = document.getElementById("auto");
    const sendGenerateButton = document.getElementById("generate");

    const messageInput = document.getElementById("length");

    const socket = new WebSocket("ws://localhost:8080/socket");
    socket.binaryType = "arraybuffer";

    socket.onopen = function (event) {
        addMessageToWindow("Connected to webSocket....");
    };

    socket.onmessage = function(evt) {
        let json = JSON.parse(evt.data);
        console.log(json);
    };

    sendAutoButton.onclick = function (event) {
        sendAutoMessageLength(messageInput.value);
        messageInput.value = "";
    };

    sendGenerateButton.onclick = function (event) {
        sendGenerateMessage();
    };

    function sendGenerateMessage() {
        addMessageToWindow("Generated array output: " + this.content)
        let json = JSON.stringify({
            "content": this.content
        });
        socket.send(json);
    }

    function sendAutoMessageLength(length) {
        socket.send(length);
        addMessageToWindow("Entered number: " + length);
        sendAutoMessage();
    }

    let users = ${autoPageJSON};

    function sendAutoMessage() {
        addMessageToWindow("Auto array output: "  + this.content);
        let json = JSON.stringify({
            "content": this.content
        });
        socket.send(json);
        repeat();
    }

    function addMessageToWindow(length) {
        messageWindow.innerHTML += `<div>${length}</div>`
    }

    function repeat() {
        let repeat = setInterval(sendAutoMessage, 10000);
        let end = 100000;
        if (end)
            setTimeout(function() {
                clearInterval(repeat);
                }, end);
    }

    // function auto() {
    //     socket.send(JSON.stringify({
    //         command: 'auto',
    //         params: {
    //             type: 'randomArrayCertainLengthResult'
    //         }
    //     }));
    // }

</script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</html>